{% extends 'header.html' %}
{% block content %}
<div class="row g-0 " style="padding: 0; border: 1px solid rgba(0, 0, 0, 0.125);">
    <div class="col-12 d-flex flex-row p-3 gap-3">
        <div class="d-flex flex-column justify-content-center" onclick="openstart();">
            <div class="" style=" text-align: center;">
                <i class="fa-solid fa-circle-play"
                    style="font-size: 36px; color: #1FB148; text-align: center;  cursor: pointer;"></i>
            </div>
            <div style="text-align: center; font-size: 14px;">작업 시작</div>
        </div>
        <div class="d-flex flex-column justify-content-center" onclick="openTimeline();">
            <div class="" style=" text-align: center;">
                <i class="fa-solid fa-clipboard"
                    style="font-size: 36px; color: #868686; text-align: center;  cursor: pointer;"></i>
            </div>
            <div style="text-align: center; font-size: 14px;">작업 내역</div>
        </div>
    </div>
</div>
<div class="row" style="margin-left: 0; margin-right: 0;">
    <div class="wrapper col-2 shadow-sm list-group">
        <div class="col d-flex flex-column align-items-stretch flex-shrink-0 bg-white">
            <div class="p-3 list-group-item d-flex flex-row justify-content-between"
                style="background-color:rgba(0, 0, 0, 0.03);">
                <div style="font-weight: 600;" id="option-name">옵션 뷰</div>
            </div>
            <div>
                <div class="accordion-body border-bottom border-primary border-5" id="option-detail" style="display: none;">
    
                </div>
            </div>
            <div class="p-3 list-group-item d-flex flex-row justify-content-between "
                style="background-color:rgba(0, 0, 0, 0.03);">
                <div style="font-weight: 600; ">작업</div>
            </div>
            <div class="accordion" id="menu">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingOne">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse"
                            data-bs-target="#data-input" aria-expanded="true" aria-controls="data-input"
                            style="font-weight: 600;">
                            데이터
                        </button>
                    </h2>
                    <div class="collapse collapse-horizontal show" id="data-input" style="padding-left:0 1rem;">
                        <div class="drag-drawflow list-group-item" draggable="true" ondragstart="drag(event)"
                            data-node="pet">
                            <div><i class="fa-solid fa-database "
                                    style="color: #868686; font-size: 20px; margin-right: 0.3em;"></i>pet</div>
                        </div>
                        <div class="list-group-item" onclick="openPopup();">
                            <div class="d-flex flex-row justify-content-center"><i class="fa-solid fa-circle-plus"
                                    style="font-size: 20px; margin-right: 0.3em; color:#0d6efd;"></i></div>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingOne">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse"
                            data-bs-target="#machining" aria-expanded="true" aria-controls="machining"
                            style="font-weight: 600;">
                            가공
                        </button>
                    </h2>
                    <div class="collapse collapse-horizontal  show" id="machining" style="padding-left:0 1rem;">
                        <div class="drag-drawflow list-group-item border-bottom" draggable="true"
                            ondragstart="drag(event)" data-node="coco">
                            <div><i class="fa-solid fa-right-left"
                                    style="color: #868686; font-size: 20px; margin-right: 0.3em;"></i>COCO 데이터셋 변환</div>
                        </div>
                        <div class="drag-drawflow list-group-item  border-bottom" draggable="true"
                            ondragstart="drag(event)" data-node="hawkeye">
                            <div><i class="fa-solid fa-photo-film"
                                    style="color: #868686; font-size: 20px; margin-right: 0.3em;"></i>Hawkeye
                            </div>
                        </div>
                        <div class="drag-drawflow list-group-item" draggable="true" ondragstart="drag(event)"
                            data-node="videotoimage">
                            <div><i class="fa-solid fa-right-left"
                                    style="color: #868686; font-size: 20px; margin-right: 0.3em;"></i>Video를 이미지로 변환
                            </div>
                        </div>
                        <div class="list-group-item" onclick="optionPopup();">
                            <div class="d-flex flex-row justify-content-center"><i class="fa-solid fa-circle-plus"
                                    style="font-size: 20px; margin-right: 0.3em; color:#0d6efd;"></i></div>
                        </div>
                    </div>
                </div>
                <!--
                <div class="accordion-item">
                    <h2 class="accordion-header" id="">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse"
                            data-bs-target="#learning" aria-expanded="false" aria-controls="learning"
                            style="font-weight: 600;">
                            학습
                        </button>
                    </h2>
                    <div class="collapse collapse-horizontal  show" id="learning" style="padding-left:0 1rem;">
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse"
                            data-bs-target="#evaluation" aria-expanded="false" aria-controls="evaluation"
                            style="font-weight: 600;">
                            평가
                        </button>
                    </h2>
                    <div class="collapse collapse-horizontal" id="evaluation" style="padding-left:0 1rem;">
                    </div>
                </div>-->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingOne">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse"
                            data-bs-target="#interlock" aria-expanded="true" aria-controls="interlock"
                            style="font-weight: 600;">
                            연동
                        </button>
                    </h2>
                    <div class="collapse collapse-horizontal  show" id="interlock" style="padding-left:0 1rem;">
                        <div class="drag-drawflow list-group-item" draggable="true" ondragstart="drag(event)"
                            data-node="xdq">
                            <div><i class="fa-solid fa-circle-nodes"
                                    style="color: #868686; font-size: 20px; margin-right: 0.3em;"></i>XDQ 연동</div>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingOne">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse"
                            data-bs-target="#viewer" aria-expanded="true" aria-controls="viewer"
                            style="font-weight: 600;">
                            뷰어
                        </button>
                    </h2>
                    <div class="collapse collapse-horizontal  show" id="viewer" style="padding-left:0 1rem;">

                        <div class="drag-drawflow list-group-item" draggable="true" ondragstart="drag(event)"
                            data-node="original-viewer">
                            <div><i class="fa-solid fa-images"
                                    style="color: #868686; font-size: 20px; margin-right: 0.3em;"></i>원본 이미지 뷰어
                            </div>
                        </div>
                        <div class="drag-drawflow list-group-item" draggable="true" ondragstart="drag(event)"
                            data-node="test-viewer">
                            <div><i class="fa-solid fa-images"
                                    style="color: #868686; font-size: 20px; margin-right: 0.3em;"></i>검사 이미지 뷰어
                            </div>
                        </div>
                        <div class="drag-drawflow list-group-item" draggable="true" ondragstart="drag(event)"
                            data-node="label-viewer">
                            <div><i class="fa-solid fa-images"
                                    style="color: #868686; font-size: 20px; margin-right: 0.3em;"></i>라벨링 이미지 뷰어
                            </div>
                        </div>
                        <div class="drag-drawflow list-group-item" draggable="true" ondragstart="drag(event)"
                            data-node="chart">
                            <div>
                                <i class="fa-solid fa-chart-pie"
                                    style="color: #868686; font-size: 20px; margin-right: 0.3em;"></i>통계
                            </div>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingOne">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse"
                            data-bs-target="#template" aria-expanded="true" aria-controls="template"
                            style="font-weight: 600;">
                            템플릿
                        </button>
                    </h2>
                    <div class="collapse collapse-horizontal  show" id="template" style="padding-left:0 1rem;">

                        <div class="drag-drawflow list-group-item" draggable="true" ondragstart="drag(event)"
                            data-node="template">
                            <div><i class="fa-solid fa-code"
                                    style="color: #868686; font-size: 20px; margin-right: 0.3em;"></i>코드 커스텀
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-10 ">
        <div class="card" style="background-color:rgba(0, 0, 0, 0.0);">
            <div class="card-header d-flex flex-row p-3" style="font-weight: 600; ">
                <div class="">Project01</div>
            </div>

            <div class="card-body" style="background-color:rgba(0, 0, 0, 0.0);">
                <div class="d-flex flex-row justify-content-between ">
                    <div class="gap-3 d-flex flex-row">
                        <div id="lock" onclick="editor.editor_mode='fixed'; changeMode('lock');">
                            <button class="btn btn-outline-primary">
                                <i class="fas fa-lock "></i>
                            </button>
                        </div>
                        <div id="unlock" onclick="editor.editor_mode='edit'; changeMode('unlock');"
                            style="display:none;">
                            <button class="btn btn-outline-primary">
                                <i class="fas fa-lock-open"></i>
                            </button>
                        </div>
                        <div onclick="editor.zoom_out()">
                            <button class="btn btn-outline-primary">
                                <i class="fas fa-search-minus"></i>
                            </button>
                        </div>
                        <div onclick="editor.zoom_reset()">
                            <button class="btn btn-outline-primary">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        <div onclick="editor.zoom_in()">
                            <button class="btn btn-outline-primary">
                                <i class="fas fa-search-plus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="gap-3 d-flex flex-row" style="float: right;">
                        <div>
                            <button class="btn btn-outline-primary" aria-current="page" onclick="exportmodal()">
                                내보내기
                            </button>
                        </div>
                        <div>
                            <button class="btn btn-outline-primary" onclick="editor.clearModuleSelected()">
                                모두 지우기
                            </button>
                        </div>
                    </div>

                </div>

                <div class=" col-12 drawflow" id="drawflow" style="height: 600px;" ondrop="drop(event)"
                    ondragover="allowDrop(event)">
                </div>

            </div>
        </div>
    </div>




</div>

<div class="modal" id="modal-start" tabindex="-1" style="display: none;">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">안 내</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>해당 워크플로우의 작업을 시작합니까?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary"
                    onclick="startWork();closePopup('modal-start');">Yes</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                    onclick="closePopup('modal-start');">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="modal-export" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">내보내기</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="div-export" style="overflow-y: auto;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                    onclick="closePopup('modal-start');">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="modal-codeblock" tabindex="-1" style="display: none;">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">코드 커스텀 - python</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <textarea  class="form-control" style="overflow-y: hidden;" rows="11" readonly>
                    import os
                    import random
                    import shutil
                    import argparse
                    from configuration import TRAIN_SET_RATIO, TEST_SET_RATIO
                    if __name__ == '__main__':
                        initProcessing()
                        # 예약어 정보
                        # file_path : 입력 파일 Path정보
                        #구현 옵션 사항
                        # SendProgress(int (0~100)) : 진행률 전달하기 위함
                </textarea>
                <textarea  class="form-control" rows="11">
                        #파일 리스트 만드는 예제
                        for file in os.listdir(type_file_path):
                                    single_file_path = os.path.join(type_file_path, file[:file.rfind("-")+1])
                                    frame_name = file[file.rfind("-")+1:]
                                    if not single_file_path in file_path:
                                        #해당프레임의 첫 이미지
                                        file_path[single_file_path] = list([frame_name])
                                    else :
                                        file_path[single_file_path].append(frame_name)
                                        #file path : dict {"경로명+액션명": list(S01.jpg, S01.json....), }
                                    all_file_path.append(file_path)
                </textarea>
                <textarea class="form-control" style="overflow-y: hidden;" rows="1" readonly>
                    outputProcessing()
                </textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal"
                    onclick="closePopup('modal-start');">저장</button>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="modal" tabindex="-1" style="display: none;">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">옵션 추가</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <ul class="nav nav-tabs nav-pills nav-fill">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#" id="network">NetWorkDrive</a>
                    </li>
                    <!--
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="FTP">FTP</a>
                    </li>-->
                </ul>
                <form class="p-3">
                    <div class="mb-2 input-group-sm">
                        <label for="exampleDropdownFormEmail1" class="form-label">
                            이름</label>
                        <input type="text" class="form-control " id="optionname" placeholder="">
                    </div>
                    <div class="mb-2 input-group-sm">
                        <label for="URL" class="form-label">IP</label>
                        <input type="text" class="form-control input-group-sm" id="URL" placeholder="127.0.0.1/example">
                    </div>
                    <div class="mb-2 input-group-sm">
                        <label for="ID" class="form-label">ID</label>
                        <input class="form-control" style="resize: none;" id="ID" rows="5"></input>
                    </div>
                    <div class="mb-2 input-group-sm">
                        <label for="exampleFormControlTextarea1" class="form-label">비밀번호</label>
                        <input type="password" class="form-control" style="resize: none;" id="password" rows="5"></input>
                    </div>
                    <div class="mb-2 form-check" style="">
                        <label class="form-check-label" for="defaultCheck2">데이터 변화 감지(Watching)</label>
                        <input class="form-check-input" type="checkbox" id="watching">
                    </div>
                    <div class="mb-2 form-check" style="" id="registeredURL">
    
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal"
                    onclick="closePopup('modal-start');">저장</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                    onclick="closePopup('modal-start');">Close</button>
            </div>
        </div>            
    </div>
</div>

<div class="modal" id="modal-option" tabindex="-1" style="display: none;">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">옵션 추가</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class='input-group my-3'>
                    <span class='input-group-text'>URL</span>
                    <input type='text' class='form-control' placeholder='\\127.0.0.1\example'></div>
                    <div class='input-group my-3'>
                        <textarea class='form-control' aria-label='With textarea' rows='5'></textarea>
                    </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal"
                    onclick="closePopup('modal-start');">저장</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                    onclick="closePopup('modal-start');">Close</button>
            </div>
        </div>            
    </div>
</div>

<div class="modal" id="modal-timeline" tabindex="-1" style="display: none;">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="card">
                <div class="card-body">
                    <h6 class="card-title">작업 내역</h6>
                    <div id="content">
                        <ul class="timeline">
                            <li class="event" data-date="2023-02-03 17:48:48">
                                <h3> 이미지 라벨링 작업 완료</h3>
                                <p>성공 : 199,995 건
                                    실패 : 5 건</p>
                            </li>
                            <li class="event" data-date="2023-02-02 11:00:36">
                                <h3> 이미지 라벨링 작업 시작 </h3>
                                <p>성공 : 120,000 건
                                    실패 : 0 건</p>
                            </li>
                            <li class="event" data-date="2023-02-01 14:04:01">
                                <h3>pet 데이터 추가</h3>
                                <p>성공 : 120,000 건
                                    실패 : 0 건</p>
                            </li>
                            <li class="event" data-date="2023-02-01 14:00:01">
                                <h3>프로젝트 생성</h3>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<style>
    #menu {
        overflow-y: auto;
        height: 100vh;
    }

    body::-webkit-scrollbar {
        width: 8px;
        /* 스크롤바의 너비 */
    }

    body::-webkit-scrollbar-thumb {
        height: 30%;
        /* 스크롤바의 길이 */
        background: #dadada;
        /* 스크롤바의 색상 */

        border-radius: 10px;
    }

    body::-webkit-scrollbar-track {
        background: rgba(241, 241, 241, 0.1);
        /*스크롤바 뒷 배경 색상*/
    }

    /*timeilne*/

    .timeline {
        border-left: 3px solid #727cf5;
        border-bottom-right-radius: 4px;
        border-top-right-radius: 4px;
        background: rgba(114, 124, 245, 0.09);
        margin: 0 auto;
        letter-spacing: 0.2px;
        position: relative;
        line-height: 1.4em;
        font-size: 1.03em;
        padding: 50px;
        list-style: none;
        text-align: left;
        max-width: 40%;
    }

    @media (max-width: 767px) {
        .timeline {
            max-width: 98%;
            padding: 25px;
        }
    }

    .timeline h1 {
        font-weight: 300;
        font-size: 1.4em;
    }

    .timeline h2,
    .timeline h3 {
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 10px;
    }

    .timeline .event {
        border-bottom: 1px dashed #e8ebf1;
        padding-bottom: 25px;
        margin-bottom: 25px;
        position: relative;
    }

    @media (max-width: 767px) {
        .timeline .event {
            padding-top: 30px;
        }
    }

    .timeline .event:last-of-type {
        padding-bottom: 0;
        margin-bottom: 0;
        border: none;
    }

    .timeline .event:before,
    .timeline .event:after {
        position: absolute;
        display: block;
        top: 0;
    }

    .timeline .event:before {
        left: -207px;
        content: attr(data-date);
        text-align: right;
        font-weight: 100;
        font-size: 0.9em;
        min-width: 120px;
    }

    @media (max-width: 767px) {
        .timeline .event:before {
            left: 0px;
            text-align: left;
        }
    }

    .timeline .event:after {
        -webkit-box-shadow: 0 0 0 3px #727cf5;
        box-shadow: 0 0 0 3px #727cf5;
        left: -55.8px;
        background: #fff;
        border-radius: 50%;
        height: 9px;
        width: 9px;
        content: "";
        top: 5px;
    }

    @media (max-width: 767px) {
        .timeline .event:after {
            left: -31.8px;
        }
    }

    .rtl .timeline {
        border-left: 0;
        text-align: right;
        border-bottom-right-radius: 0;
        border-top-right-radius: 0;
        border-bottom-left-radius: 4px;
        border-top-left-radius: 4px;
        border-right: 3px solid #727cf5;
    }

    .rtl .timeline .event::before {
        left: 0;
        right: -170px;
    }

    .rtl .timeline .event::after {
        left: 0;
        right: -55.8px;
    }
</style>

</div>
<script>
    let projectJson = JSON.parse(JSON.stringify(projectlist));
    let storageJson = JSON.parse(JSON.stringify(storage));
    console.log(projectJson);
    console.log(storageJson);

    var id = document.getElementById("drawflow");
    const editor = new Drawflow(id);
    editor.reroute = true;
    const dataToImport = {
        "drawflow": {
            "Home": {
                "data": {
                }
            }
        }
    }
    editor.start();
    editor.import(dataToImport);


    /*
        var welcome = `
        <div>
          <div class="title-box">👏 Welcome!!</div>
          <div class="box">
            <p>Simple flow library <b>demo</b>
            <a href="https://github.com/jerosoler/Drawflow" target="_blank">Drawflow</a> by <b>Jero Soler</b></p><br>
    
            <p>Multiple input / outputs<br>
               Data sync nodes<br>
               Import / export<br>
               Modules support<br>
               Simple use<br>
               Type: Fixed or Edit<br>
               Events: view console<br>
               Pure Javascript<br>
            </p>
            <br>
            <p><b><u>Shortkeys:</u></b></p>
            <p>🎹 <b>Delete</b> for remove selected<br>
            💠 Mouse Left Click == Move<br>
            ❌ Mouse Right == Delete Option<br>
            🔍 Ctrl + Wheel == Zoom<br>
            📱 Mobile support<br>
            ...</p>
          </div>
        </div>
        `;
    */


    //editor.addNode(name, inputs, outputs, posx, posy, class, data, html);
    /*editor.addNode('welcome', 0, 0, 50, 50, 'welcome', {}, welcome );
    editor.addModule('Other');
    */

    // Events!
    editor.on('nodeCreated', function (id) {
        console.log("Node created " + id);
    })

    editor.on('nodeRemoved', function (id) {
        console.log("Node removed " + id);
    })

    editor.on('nodeSelected', function (id) {
        console.log("Node selected " + id);
    })

    editor.on('moduleCreated', function (name) {
        console.log("Module Created " + name);
    })

    editor.on('moduleChanged', function (name) {
        console.log("Module Changed " + name);
    })

    editor.on('connectionCreated', function (connection) {
        console.log('Connection created');
        console.log(connection);
    })

    editor.on('connectionRemoved', function (connection) {
        console.log('Connection removed');
        console.log(connection);
    })

    editor.on('mouseMove', function (position) {
        //console.log('Position mouse x:' + position.x + ' y:' + position.y);
    })

    editor.on('nodeMoved', function (id) {
        console.log("Node moved " + id);
    })

    editor.on('zoom', function (zoom) {
        console.log('Zoom level ' + zoom);
    })

    editor.on('translate', function (position) {
        console.log('Translate x:' + position.x + ' y:' + position.y);
    })

    editor.on('addReroute', function (id) {
        console.log("Reroute added " + id);
    })

    editor.on('removeReroute', function (id) {
        console.log("Reroute removed " + id);
    })

    /* DRAG EVENT */

    /* Mouse and Touch Actions */

    var elements = document.getElementsByClassName('drag-drawflow');
    for (var i = 0; i < elements.length; i++) {
        elements[i].addEventListener('touchend', drop, false);
        elements[i].addEventListener('touchmove', positionMobile, false);
        elements[i].addEventListener('touchstart', drag, false);
    }

    var mobile_item_selec = '';
    var mobile_last_move = null;

    function positionMobile(ev) {
        mobile_last_move = ev;
    }

    function allowDrop(ev) {
        ev.preventDefault();
    }

    function drag(ev) {
        if (ev.type === "touchstart") {
            mobile_item_selec = ev.target.closest(".drag-drawflow").getAttribute('data-node');
        } else {
            ev.dataTransfer.setData("node", ev.target.getAttribute('data-node'));
        }
    }

    function drop(ev) {
        if (ev.type === "touchend") {
            var parentdrawflow = document.elementFromPoint(mobile_last_move.touches[0].clientX, mobile_last_move
                .touches[0].clientY).closest("#drawflow");
            if (parentdrawflow != null) {
                addNodeToDrawFlow(mobile_item_selec, mobile_last_move.touches[0].clientX, mobile_last_move.touches[0]
                    .clientY);
            }
            mobile_item_selec = '';
        } else {
            ev.preventDefault();
            var data = ev.dataTransfer.getData("node");
            addNodeToDrawFlow(data, ev.clientX, ev.clientY);
        }

    }

    function addNodeToDrawFlow(name, pos_x, pos_y) {
        if (editor.editor_mode === 'fixed') {
            return false;
        }
        pos_x = pos_x * (editor.precanvas.clientWidth / (editor.precanvas.clientWidth * editor.zoom)) - (editor
            .precanvas.getBoundingClientRect().x * (editor.precanvas.clientWidth / (editor.precanvas.clientWidth *
                editor.zoom)));
        pos_y = pos_y * (editor.precanvas.clientHeight / (editor.precanvas.clientHeight * editor.zoom)) - (editor
            .precanvas.getBoundingClientRect().y * (editor.precanvas.clientHeight / (editor.precanvas.clientHeight *
                editor.zoom)));


        var url='',detail='';
        switch (name) {
            case 'pet':
                var pet = `
                <div class='d-flex flex-row' onclick="dataClick('pet')">
                    <div class='d-flex flex-row justify-content-between'>
                        <div><i class='fa-solid fa-database'></i></div>
                        <div> pet</div>
                    </div> 
                </div>
                `;
                editor.addNode('pet', 0, 1, pos_x, pos_y, 'data', {}, pet);
                break;

            case 'original-viewer':
                var originalViewer = `
              <div>
                <div class='title-box'><i class='fa-solid fa-images'></i>원본 이미지 뷰어</div>
                
              </div>
              `
                editor.addNode('original-viewer', 1, 0, pos_x, pos_y, 'viewer', {}, originalViewer);
                break;

            case 'test-viewer':
                var testViewer = `
              <div>
                <div class='title-box'><i class='fa-solid fa-images'></i>검사 이미지 뷰어</div>
                
              </div>
              `
                editor.addNode('test-viewer', 1, 0, pos_x, pos_y, 'viewer', {}, testViewer);
                break;

            case 'label-viewer':
                var labelviewer = `
              <div>
                <div class='title-box'><i class='fa-solid fa-images'></i>라벨링 이미지 뷰어</div>
                
              </div>
              `
                editor.addNode('label-viewer', 1, 0, pos_x, pos_y, 'viewer', {}, labelviewer);
                break;

            case 'chart':
                var chart = `
              <div>
                <div class='title-box'><i class='fa-solid fa-chart-pie'></i>통계</div>
              </div>
              `
                editor.addNode('chart', 1, 0, pos_x, pos_y, 'viewer', {}, chart);
                break;
            case 'hawkeye':
                var hawkeye = `
                <div onclick="hawkeyeClick()">
                    <div class='title-box'><i class='fa-solid fa-photo-film'></i> Hawkeye</div>
                    <div>
                        <div class='progress mb-2' role='progressbar' aria-label='Basic example' aria-valuenow='0' aria-valuemin='0' aria-valuemax='100'  style='height:8px;'>
                        <div class='progress-bar'></div>
                    </div>
                    </div>
                </div>
              `;
                editor.addNode('hawkeye', 1, 1, pos_x, pos_y, 'machining', {}, hawkeye);
                break;
            case 'coco':
                var coco = `
              <div onclick="cocoClick('COCO데이터셋 변환');">
                <div class='title-box'><i class='fa-solid fa-right-left'></i> COCO데이터셋 변환</div>
                <div>
                    <div>
                        <div class='progress mb-2' role='progressbar' aria-label='Basic example' aria-valuenow='0' aria-valuemin='0' aria-valuemax='100'  style='height:8px;'>
                        <div class='progress-bar'></div>
                    </div>
                </div>
              </div>
              `
                editor.addNode('coco', 1, 1, pos_x, pos_y, 'machining', {}, coco);
                break;
            case 'videotoimage':
                var videotoimage = `
              <div onclick="videoClick('비디오를 이미지로 변환');">
                <div class='title-box'><i class='fa-solid fa-right-left'></i> 비디오를 이미지로 변환</div>
                <div>
                    <div>
                        <div class='progress mb-2' role='progressbar' aria-label='Basic example' aria-valuenow='0' aria-valuemin='0' aria-valuemax='100'  style='height:8px;'>
                        <div class='progress-bar'></div>
                    </div>
                </div>
              </div>
              `
                editor.addNode('videotoimage', 1, 1, pos_x, pos_y, 'machining', {}, videotoimage);
                break;
            case 'xdq':
                var xdq = `
              <div class='' >
                <div class='title-box'><i class='fa-solid fa-circle-nodes'></i>XDQ 연동</div>
                <div class='d-flex flex-row justify-content-center my-2 ' style='text-align: center;'>
                    <button class='btn btn-primary' onclick='moveXDQ()'>XDQ</button>
                   
                </div>
              </div>
              `;
                editor.addNode('xdq', 1, 0, pos_x, pos_y, 'xdq', {}, xdq);
                break;

            case 'template':
                var template = `
              <div class='' >
                <div class='title-box'><i class='fa-solid fa-code'></i>코드 커스텀</div>
                <div class='d-flex flex-row justify-content-center my-2 ' style='text-align: center;'>
                    <button class='btn btn-primary' onclick='codeblock()'>코드 작성</button>
                </div>
              </div>
              `;
                editor.addNode('template', 1, 1, pos_x, pos_y, 'template', {}, template);
                break;

            case 'telegram':
                var telegrambot = `
              <div>
                <div class='title-box'><i class='fab fa-telegram-plane'></i> Telegram bot</div>
                <div class='box'>
                  <p>Send to telegram</p>
                  <p>select channel</p>
                  <select df-channel>
                    <option value='channel_1'>Channel 1</option>
                    <option value='channel_2'>Channel 2</option>
                    <option value='channel_3'>Channel 3</option>
                    <option value='channel_4'>Channel 4</option>
                  </select>
                </div>
              </div>
              `;
                editor.addNode('telegram', 1, 0, pos_x, pos_y, 'telegram', {
                    'channel': 'channel_3'
                }, telegrambot);
                break;
            case 'aws':
                var aws = `
              <div>
                <div class='title-box'><i class='fab fa-aws'></i> Aws Save </div>
                <div class='box'>
                  <p>Save in aws</p>
                  <input type='text' df-db-dbname placeholder='DB name'><br><br>
                  <input type='text' df-db-key placeholder='DB key'>
                  <p>Output Log</p>
                </div>
              </div>
              `;
                editor.addNode('aws', 1, 1, pos_x, pos_y, 'aws', {
                    'db': {
                        'dbname': '',
                        'key': ''
                    }
                }, aws);
                break;
            case 'log':
                var log = `
                <div>
                  <div class='title-box'><i class='fas fa-file-signature'></i> Save log file </div>
                </div>
                `;
                editor.addNode('log', 1, 0, pos_x, pos_y, 'log', {}, log);
                break;
            case 'email':
                var email = `
                <div>
                  <div class='title-box'><i class='fas fa-at'></i> Send Email </div>
                </div>
                `;
                editor.addNode('email', 1, 0, pos_x, pos_y, 'email', {}, email);
                break;

            case 'template':
                var template = `
                <div>
                  <div class='title-box'><i class='fas fa-code'></i> Template</div>
                  <div class='box'>
                    Ger Vars
                    <textarea df-template></textarea>
                    Output template with vars
                  </div>
                </div>
                `;
                editor.addNode('template', 1, 1, pos_x, pos_y, 'template', {
                    'template': 'Write your template'
                }, template);
                break;
            case 'multiple':
                var multiple = `
                <div>
                  <div class='box'>
                    Multiple!
                  </div>
                </div>
                `;
                editor.addNode('multiple', 3, 4, pos_x, pos_y, 'multiple', {}, multiple);
                break;
            case 'personalized':
                var personalized = `
                <div>
                  Personalized
                </div>
                `;
                editor.addNode('personalized', 1, 1, pos_x, pos_y, 'personalized', {}, personalized);
                break;
            case 'dbclick':
                var dbclick = `
                <div>
                <div class='title-box'><i class='fas fa-mouse'></i> Db Click</div>
                  <div class='box dbclickbox' ondblclick='showpopup(event)'>
                    Db Click here
                    <div class='modal' style='display:none'>
                      <div class='modal-content'>
                        <span class='close' onclick='closemodal(event)'>&times;</span>
                        Change your variable {name} !
                        <input type='text' df-name>
                      </div>
    
                    </div>
                  </div>
                </div>
                `;
                editor.addNode('dbclick', 1, 1, pos_x, pos_y, 'dbclick', {
                    name: ''
                }, dbclick);
                break;
            default:
        }
    }

    var transform = '';

    function showpopup(e) {
        e.target.closest(".drawflow-node").style.zIndex = "9999";
        e.target.children[0].style.display = "block";
        //document.getElementById("modalfix").style.display = "block";

        //e.target.children[0].style.transform = 'translate('+translate.x+'px, '+translate.y+'px)';
        transform = editor.precanvas.style.transform;
        editor.precanvas.style.transform = '';
        editor.precanvas.style.left = editor.canvas_x + 'px';
        editor.precanvas.style.top = editor.canvas_y + 'px';
        console.log(transform);

        //e.target.children[0].style.top  =  -editor.canvas_y - editor.container.offsetTop +'px';
        //e.target.children[0].style.left  =  -editor.canvas_x  - editor.container.offsetLeft +'px';
        editor.editor_mode = "fixed";

    }

    function closemodal(e) {
        e.target.closest(".drawflow-node").style.zIndex = "2";
        e.target.parentElement.parentElement.style.display = "none";
        //document.getElementById("modalfix").style.display = "none";
        editor.precanvas.style.transform = transform;
        editor.precanvas.style.left = '0px';
        editor.precanvas.style.top = '0px';
        editor.editor_mode = "edit";
    }

    function changeModule(event) {
        var all = document.querySelectorAll(".menu ul li");
        for (var i = 0; i < all.length; i++) {
            all[i].classList.remove('selected');
        }
        event.target.classList.add('selected');
    }

    function changeMode(option) {
        var lock = document.getElementById("lock");
        var unlock = document.getElementById("unlock");

        //console.log(lock.id);
        if (option == 'lock') {
            lock.style.display = 'none';
            unlock.style.display = 'block';
        } else {
            lock.style.display = 'block';
            unlock.style.display = 'none';
        }

    }

    function optionPopup(){
        $("#modal-option").modal("show");
    }

    function codeblock() {
        $("#modal-codeblock").modal("show");

    }

    function startWork() {
        console.log(JSON.stringify(editor.export(), null, 4));
        n = 13
        console.log(editor.export().drawflow.Home.data[n].name);
        var name = editor.export().drawflow.Home.data[n].name;

        var a = document.getElementById(name + "-url").value;
        var b = document.getElementById(name + "-setting").value;

        console.log(a + b);
    }

    function openPopup(name) {
        $("#modal").modal("show");

        if (name == 'pet') {
            fillName();
        }
    }

    function fillName() {
        document.getElementById("optionname").value = "pet";
        document.getElementById("URL").value = '\\\\192.168.25.184\\share_folder\\PET';
        document.getElementById("ID").value = 'gazzilabs';
        document.getElementById("password").value = 'gazzilabs123123**';
        document.getElementById("watching").checked = true;
    }

    function exportmodal() {
        $("#modal-export").modal("show");
        console.log(JSON.stringify(editor.export(), null, 4));
        document.getElementById("div-export").innerText = JSON.stringify(editor.export(), null, 4);
    }

    function openTimeline() {
        $("#modal-timeline").modal("show");
    }

    function closePopup(id) {
        $("#" + id).modal("hide");
    }

    function moveXDQ() {
        window.open('http://101.101.219.218:8000/', 'XDQ');
    }

    function openstart() {
        $("#modal-start").modal("show");
    }


    //클릭이벤트
    function dataClick(name){
        $("#option-detail").show();

        document.getElementById("option-name").innerText = name;        
        document.getElementById("option-detail").innerHTML = `
            <ul class="nav  nav-tabs nav-pills nav-fill">
                <li class="nav-item ">
                    <a class="nav-link active" aria-current="page" id="network">NetWorkDrive</a>
                </li>
                <!--
                <li class="nav-item">
                    <a class="nav-link" id="FTP">FTP</a>
                </li>-->
            </ul>
            <form class="p-3">
                <div class="mb-2 input-group-sm">
                    <label for="exampleDropdownFormEmail1" class="form-label">
                        이름</label>
                    <input type="text" class="form-control " id="optionname" placeholder="">
                </div>
                <div class="mb-2 input-group-sm">
                    <label for="URL" class="form-label">IP</label>
                    <input type="text" class="form-control input-group-sm" id="URL" placeholder="127.0.0.1/example">
                </div>
                <div class="mb-2 input-group-sm">
                    <label for="ID" class="form-label">ID</label>
                    <input class="form-control" style="resize: none;" id="ID" rows="5"></input>
                </div>
                <div class="mb-2 input-group-sm">
                    <label for="exampleFormControlTextarea1" class="form-label">비밀번호</label>
                    <input type="password" class="form-control" style="resize: none;" id="password" rows="5"></input>
                </div>
                <div class="mb-2 form-check" style="">
                    <label class="form-check-label" for="defaultCheck2">데이터 변화 감지(Watching)</label>
                    <input class="form-check-input" type="checkbox" id="watching">
                </div>
                <hr>
                <div class="mb-2" style="" id="registeredURL">
                    <div>\\\\192.168.25.184\\data\\pet</div>
                    <div class="btn btn-primary float-end mb-2" onclick="closePopup('modal')">확인</div>

                </div>


            </form>
        `;
        fillName()
    }

    function hawkeyeClick(){
        $("#option-detail").show();

        document.getElementById("option-name").innerText = 'hawkeye';
        document.getElementById("option-detail").innerHTML = `
        <div class='d-flex flex-row justify-content-center my-2 ' style='text-align: center;'>
        <button class='btn btn-primary' onclick='hawkeyeSetting();'>옵션 설정</button>
        </div>
        `
    }

    function cocoClick(name){
        url = `http://118.67.129.214:7060/Analyze/Check`;
        detail = `"checkoption": {"checkservice":"scon_label_to_coco","img_ext":"jpg","label_ext":"json","dataset_split":[8,1,1],"save_file_prifix":"scon","threshold":{"kpt_avr_score":0.5,"rank":1}}`;
        
        urlboxFill(name, url, detail);
    }

    function videoClick(name){
        url = `http://118.67.129.214:7060/Analyze/Check`;
        detail = `"checkoption":{"checkservice":"scon_vid_to_img","savestorage":{"dir":"n2690722_GazziLabs/scon_data/image","ip":"10.250.53.94","loginid":"hawkeye","loginpw":"gazzilabs@123"},"img_ext":"JPG","vid_ext":"MOV","size":[1920,1080],"fps":1,"fileoverwrite":1}`;
        
        urlboxFill(name, url, detail);
    }
    
    
    function urlboxFill(name, url, detail){
        $("#option-detail").show();

        document.getElementById("option-name").innerText = name;
        document.getElementById("option-detail").innerHTML = urlboxCreate();

        document.getElementById("url").value = url;
        document.getElementById("setting").value = detail

    }

    function urlboxCreate(){
        
        var box = `
        <div class='input-group my-3'>
                        <span class='input-group-text'>URL</span>
                        <input type='text' class='form-control' id="url"></div>
                        <div class='input-group my-3'>
                            <textarea class='form-control' aria-label='With textarea' rows='5' id='setting' ></textarea>
                        </div>
        `;

        return box;
    }
</script>


{% include 'medialist.html' %}
{% include 'imageview.html' %}
{% include 'statsview.html' %}
{% endblock %}